<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>VSA Táº¿t Photo Booth ğŸŒº</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Space+Mono&display=swap" rel="stylesheet">
<style>
  :root { --red:#c0392b; --deep:#6b1a1a; --gold:#f0c040; --gold2:#b8860b; --cream:#fdf3e3; --paper:#fff8ee; --peach:#f9c784; }
  *,*::before,*::after { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body { width:100%; min-height:100vh; background:var(--deep); font-family:'Space Mono',monospace; color:var(--cream); overscroll-behavior:none; }

  #startScreen { position:fixed; inset:0; z-index:100; background:var(--deep); display:flex; flex-direction:column; align-items:center; justify-content:center; gap:18px; padding:24px; }
  .lanterns { font-size:2rem; letter-spacing:.6rem; animation:sway 2s ease-in-out infinite alternate; }
  @keyframes sway { from{transform:rotate(-4deg)} to{transform:rotate(4deg)} }
  .start-card { border:3px solid var(--gold); padding:44px 48px 40px; text-align:center; position:relative; max-width:480px; width:100%; background:rgba(100,20,20,.5); }
  .corner { position:absolute; color:var(--gold); font-size:1rem; }
  .tl{top:8px;left:10px} .tr{top:8px;right:10px} .bl{bottom:8px;left:10px} .br{bottom:8px;right:10px}
  .start-org { font-size:.6rem; letter-spacing:.3em; color:var(--peach); text-transform:uppercase; margin-bottom:8px; }
  .start-h1 { font-family:'Playfair Display',serif; font-size:clamp(2rem,6vw,3rem); color:var(--gold); line-height:1.1; margin-bottom:6px; }
  .start-sub { font-size:.85rem; color:var(--peach); margin-bottom:30px; }
  .btn-gold { display:inline-block; padding:15px 48px; background:var(--gold); color:var(--deep); border:none; font-family:'Playfair Display',serif; font-size:1.1rem; font-weight:700; letter-spacing:.08em; cursor:pointer; -webkit-appearance:none; }
  .btn-gold:disabled { opacity:.45; cursor:not-allowed; }
  .start-note { font-size:.58rem; color:var(--peach); opacity:.65; margin-top:12px; }
  #errMsg { display:none; color:#ffaaaa; font-size:.7rem; margin-top:12px; line-height:1.7; max-width:300px; margin-left:auto; margin-right:auto; }

  #app { display:none; padding:28px 16px 60px; }
  .app-header { text-align:center; margin-bottom:24px; }
  .app-header .dec { font-size:1.4rem; letter-spacing:.5rem; margin-bottom:6px; }
  .app-header h1 { font-family:'Playfair Display',serif; font-size:clamp(1.6rem,4vw,2.8rem); color:var(--gold); text-shadow:0 2px 12px rgba(0,0,0,.5); }
  .app-header p { font-size:.58rem; color:var(--peach); letter-spacing:.2em; text-transform:uppercase; margin-top:5px; }
  .layout { display:flex; gap:32px; align-items:flex-start; justify-content:center; flex-wrap:wrap; }

  .cam-side { display:flex; flex-direction:column; align-items:center; gap:12px; }
  .cam-wrap { position:relative; width:min(360px,90vw); aspect-ratio:4/3; border:3px solid var(--gold); background:#000; overflow:hidden; box-shadow:6px 6px 0 var(--gold2),0 10px 40px rgba(0,0,0,.6); }
  .lant { position:absolute; top:7px; z-index:3; font-size:1.1rem; pointer-events:none; }
  .lant.l{left:8px} .lant.r{right:8px}
  #videoEl { width:100%; height:100%; object-fit:cover; transform:scaleX(-1); }
  #countdownEl { position:absolute; inset:0; z-index:5; display:flex; align-items:center; justify-content:center; font-family:'Playfair Display',serif; font-size:7rem; color:var(--gold); text-shadow:0 0 30px rgba(240,192,64,.9); pointer-events:none; opacity:0; transition:opacity .2s; }
  #flashEl { position:absolute; inset:0; background:white; opacity:0; pointer-events:none; z-index:6; }

  .controls { display:flex; flex-direction:column; align-items:center; gap:10px; width:min(360px,90vw); }
  .filter-row { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
  .f-btn { padding:5px 11px; border:1.5px solid rgba(240,192,64,.6); background:transparent; color:var(--gold); font-family:'Space Mono',monospace; font-size:.6rem; cursor:pointer; -webkit-appearance:none; }
  .f-btn.on { background:var(--gold); color:var(--deep); border-color:var(--gold); }
  .progress { display:flex; gap:6px; align-items:center; }
  .progress span { font-size:.58rem; color:var(--peach); margin-right:4px; }
  .pip { width:30px; height:5px; background:rgba(240,192,64,.15); border:1px solid rgba(240,192,64,.5); transition:background .3s; }
  .pip.on { background:var(--gold); }
  #shootBtn { width:100%; padding:15px; background:var(--gold); color:var(--deep); border:none; font-family:'Playfair Display',serif; font-size:1rem; font-weight:700; cursor:pointer; -webkit-appearance:none; }
  #shootBtn:disabled { opacity:.4; cursor:not-allowed; }

  #stickerPanel { display:none; flex-wrap:wrap; gap:5px; justify-content:center; padding:10px; border:1px dashed rgba(240,192,64,.35); width:100%; }
  .stk-label { font-size:.52rem; letter-spacing:.15em; color:var(--gold); width:100%; text-align:center; text-transform:uppercase; }
  .stk-btn { background:none; border:1.5px solid transparent; cursor:pointer; font-size:1.3rem; padding:4px; -webkit-appearance:none; }
  .stk-btn.on { border-color:var(--gold); background:rgba(240,192,64,.15); }

  #actionRow { display:none; gap:10px; width:100%; }
  .act-btn { flex:1; padding:11px; border:1.5px solid var(--gold); background:transparent; font-family:'Space Mono',monospace; font-size:.62rem; color:var(--gold); cursor:pointer; -webkit-appearance:none; }
  .act-btn:active { background:var(--gold); color:var(--deep); }

  .strip-side { position:relative; flex-shrink:0; }
  .strip-shadow { position:absolute; top:8px; left:8px; right:-8px; bottom:-8px; background:rgba(0,0,0,.25); z-index:0; }
  .strip-card { background:var(--paper); padding:14px 14px 20px; width:190px; position:relative; z-index:1; border-top:6px solid var(--red); border-bottom:6px solid var(--red); }
  .strip-head { text-align:center; padding-bottom:10px; margin-bottom:8px; border-bottom:1px solid rgba(192,57,43,.25); }
  .strip-head .vsa { font-family:'Playfair Display',serif; font-size:.72rem; color:var(--red); font-weight:700; letter-spacing:.12em; }
  .strip-head .sub { font-size:.5rem; color:var(--gold2); letter-spacing:.18em; text-transform:uppercase; margin-top:2px; }
  .strip-photos { display:flex; flex-direction:column; gap:6px; }
  .slot { width:162px; height:122px; background:#e8d5c0; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
  .slot .ph-label { font-family:'Playfair Display',serif; font-size:1.5rem; opacity:.22; color:var(--red); pointer-events:none; }
  .slot img { width:100%; height:100%; object-fit:cover; display:none; pointer-events:none; }
  .slot.filled img { display:block; } .slot.filled .ph-label { display:none; }
  .slot.target { cursor:crosshair; }
  .slot img.f-none{filter:none}
  .slot img.f-warm{filter:sepia(50%) saturate(1.4) brightness(1.05)}
  .slot img.f-soft{filter:brightness(1.12) contrast(.88) saturate(.8)}
  .slot img.f-vivid{filter:saturate(1.7) contrast(1.1)}
  .slot img.f-bw{filter:grayscale(100%)}
  .slot img.f-cool{filter:hue-rotate(200deg) saturate(.75) brightness(1.1)}
  .stk-overlay { position:absolute; inset:0; pointer-events:none; z-index:2; }
  .stk-item { position:absolute; font-size:1.4rem; line-height:1; transform:translate(-50%,-50%); }
  .strip-foot { margin-top:10px; text-align:center; }
  .strip-foot .flowers { font-size:.8rem; letter-spacing:.1rem; }
  .strip-foot .date { font-size:.45rem; color:var(--red); letter-spacing:.12em; display:block; margin-top:3px; }

  /* Save overlay */
  #saveOverlay { display:none; position:fixed; inset:0; z-index:9999; background:rgba(15,3,3,.97); flex-direction:column; align-items:center; overflow-y:auto; padding:20px 16px 40px; gap:16px; }
  #saveOverlay .save-tip { font-family:sans-serif; color:var(--peach); font-size:15px; text-align:center; line-height:1.7; }
  #saveOverlay .save-tip strong { color:var(--gold); }
  #saveImg { max-width:280px; width:100%; height:auto; display:block; box-shadow:0 8px 40px rgba(0,0,0,.6); }
  #closeOverlay { padding:12px 36px; background:var(--gold); color:var(--deep); border:none; font-family:'Playfair Display',serif; font-size:1rem; font-weight:700; cursor:pointer; }


  /* FRAME PICKER */
  #framePicker { display:none; flex-wrap:wrap; gap:8px; justify-content:center; width:100%; margin-top:4px; }
  .frame-label { font-size:.52rem; letter-spacing:.15em; color:var(--gold); width:100%; text-align:center; text-transform:uppercase; margin-bottom:2px; }
  .frame-opt { display:flex; flex-direction:column; align-items:center; gap:4px; cursor:pointer; }
  .frame-swatch { width:40px; height:56px; border:2px solid transparent; position:relative; overflow:hidden; }
  .frame-opt.active .frame-swatch { border-color:var(--gold); box-shadow:0 0 0 1px var(--gold); }
  .frame-name { font-size:.45rem; color:var(--peach); letter-spacing:.05em; }

  canvas { display:none; }
</style>
</head>
<body>

<div id="startScreen">
  <div class="lanterns">ğŸ® ğŸŒ¸ ğŸ®</div>
  <div class="start-card">
    <span class="corner tl">âœ¦</span><span class="corner tr">âœ¦</span>
    <span class="corner bl">âœ¦</span><span class="corner br">âœ¦</span>
    <p class="start-org">Vietnamese Student Association</p>
    <h1 class="start-h1">Táº¿t Photo Booth</h1>
    <p class="start-sub">ğŸŒº ChÃºc Má»«ng NÄƒm Má»›i ğŸŒº</p>
    <button class="btn-gold" id="startBtn">ğŸ“¸ Báº¯t Äáº§u Â· Start</button>
    <p class="start-note">Tap Allow when Safari asks for camera</p>
    <p id="errMsg"></p>
  </div>
  <div class="lanterns">ğŸŒ¸ ğŸ® ğŸŒ¸</div>
</div>

<div id="app">
  <!-- canvases: one for capture, one for compositing each photo with filter -->
  <canvas id="canvas"></canvas>
  <canvas id="filterCanvas"></canvas>

  <div class="app-header">
    <div class="dec">ğŸ® ğŸŒ¸ ğŸ®</div>
    <h1>VSA Táº¿t Photo Booth</h1>
    <p>ğŸŒº ChÃºc Má»«ng NÄƒm Má»›i Â· 4-Strip Photos ğŸŒº</p>
  </div>

  <div class="layout">
    <div class="cam-side">
      <div class="cam-wrap">
        <span class="lant l">ğŸ®</span><span class="lant r">ğŸ®</span>
        <video id="videoEl" autoplay playsinline muted webkit-playsinline></video>
        <div id="countdownEl"></div>
        <div id="flashEl"></div>
      </div>
      <div class="controls">
        <div class="filter-row">
          <button class="f-btn on" data-f="none">Original</button>
          <button class="f-btn" data-f="warm">Warm</button>
          <button class="f-btn" data-f="soft">Soft</button>
          <button class="f-btn" data-f="vivid">Vivid</button>
          <button class="f-btn" data-f="bw">B&amp;W</button>
          <button class="f-btn" data-f="cool">Cool</button>
        </div>
        <div id="framePicker">
          <span class="frame-label">âœ¦ Choose Frame Style âœ¦</span>
          <div class="frame-opt active" data-frame="tet">
            <div class="frame-swatch" style="background:linear-gradient(180deg,#c0392b 0%,#fff8ee 18%,#fff8ee 82%,#c0392b 100%);"></div>
            <span class="frame-name">ğŸ® Red</span>
          </div>
          <div class="frame-opt" data-frame="gold">
            <div class="frame-swatch" style="background:linear-gradient(180deg,#b8860b 0%,#fffbe6 18%,#fffbe6 82%,#b8860b 100%);"></div>
            <span class="frame-name">âœ¨ Yellow</span>
          </div>
          <div class="frame-opt" data-frame="peach">
            <div class="frame-swatch" style="background:linear-gradient(180deg,#e8829a 0%,#fff5f8 18%,#fff5f8 82%,#e8829a 100%);"></div>
            <span class="frame-name">ğŸŒ¸ Blossom</span>
          </div>
          <div class="frame-opt" data-frame="dragon">
            <div class="frame-swatch" style="background:linear-gradient(180deg,#1a472a 0%,#f0fff4 18%,#f0fff4 82%,#1a472a 100%);"></div>
            <span class="frame-name">ğŸ‰ Horse</span>
          </div>
          <div class="frame-opt" data-frame="night">
            <div class="frame-swatch" style="background:linear-gradient(180deg,#1a0a2e 0%,#0d0d1a 18%,#0d0d1a 82%,#1a0a2e 100%);"></div>
            <span class="frame-name">ğŸ† Fireworks</span>
          </div>
          <div class="frame-opt" data-frame="spring">
            <div class="frame-swatch" style="background:linear-gradient(180deg,#f77f00 0%,#fff9f0 18%,#fff9f0 82%,#f77f00 100%);"></div>
            <span class="frame-name">ğŸŠ Spring</span>
          </div>
        </div>
        <div class="progress">
          <span>Photos:</span>
          <div class="pip" id="p0"></div><div class="pip" id="p1"></div>
          <div class="pip" id="p2"></div><div class="pip" id="p3"></div>
        </div>
        <button id="shootBtn">ğŸ“· Take Photo (0 / 4)</button>
        <div id="stickerPanel">
          <span class="stk-label">âœ¦ Pick a sticker then tap a photo âœ¦</span>
          <button class="stk-btn" data-s="ğŸ®">ğŸ®</button>
          <button class="stk-btn" data-s="ğŸŒ¸">ğŸŒ¸</button>
          <button class="stk-btn" data-s="ğŸŒº">ğŸŒº</button>
          <button class="stk-btn" data-s="âœ¨">âœ¨</button>
          <button class="stk-btn" data-s="ğŸ†">ğŸ†</button>
          <button class="stk-btn" data-s="ğŸ’›">ğŸ’›</button>
          <button class="stk-btn" data-s="ğŸŠ">ğŸŠ</button>
          <button class="stk-btn" data-s="ğŸ‰">ğŸ‰</button>
          <button class="stk-btn" data-s="ğŸ’•">ğŸ’•</button>
          <button class="stk-btn" data-s="â­">â­</button>
          <button class="stk-btn" data-s="ğŸ€">ğŸ€</button>
          <button class="stk-btn" data-s="ğŸ¦‹">ğŸ¦‹</button>
        </div>
        <div id="actionRow">
          <button class="act-btn" id="retakeBtn">â†© Retake</button>
          <button class="act-btn" id="saveBtn">â†“ Save Strip</button>
        </div>
      </div>
    </div>

    <div class="strip-side">
      <div class="strip-shadow"></div>
      <div class="strip-card">
        <div class="strip-head">
          <div class="vsa">VSA Â· Táº¾T 2026</div>
          <div class="sub">ğŸŒº ChÃºc Má»«ng NÄƒm Má»›i ğŸŒº</div>
        </div>
        <div class="strip-photos">
          <div class="slot" id="slot0"><span class="ph-label">â‘ </span><img id="img0"><div class="stk-overlay" id="stk0"></div></div>
          <div class="slot" id="slot1"><span class="ph-label">â‘¡</span><img id="img1"><div class="stk-overlay" id="stk1"></div></div>
          <div class="slot" id="slot2"><span class="ph-label">â‘¢</span><img id="img2"><div class="stk-overlay" id="stk2"></div></div>
          <div class="slot" id="slot3"><span class="ph-label">â‘£</span><img id="img3"><div class="stk-overlay" id="stk3"></div></div>
        </div>
        <div class="strip-foot">
          <div class="flowers">ğŸ® ğŸŒ¸ ğŸ®</div>
          <span class="date" id="stripDate"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Save overlay -->
<div id="saveOverlay">
  <p class="save-tip">ğŸ“¥ Press &amp; hold the image below<br>then tap <strong>Save to Photos</strong></p>
  <img id="saveImg" src="" alt="Your photo strip">
  <button id="closeOverlay">âœ• Close</button>
</div>

<script>
(function(){
  'use strict';
  function $(id){ return document.getElementById(id); }

  var count=0, photos=[], activeF='none', activeS=null, shooting=false;

  $('stripDate').textContent = new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});

  var FCSS={
    'none':'none',
    'warm':'sepia(50%) saturate(1.4) brightness(1.05)',
    'soft':'brightness(1.12) contrast(.88) saturate(.8)',
    'vivid':'saturate(1.7) contrast(1.1)',
    'bw':'grayscale(100%)',
    'cool':'hue-rotate(200deg) saturate(.75) brightness(1.1)'
  };

  /* â”€â”€ START â”€â”€ */
  $('startBtn').addEventListener('click', function(){
    var btn=this; btn.disabled=true; btn.textContent='...';
    $('errMsg').style.display='none';
    if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){showErr('Please open in Safari.');return;}
    navigator.mediaDevices.getUserMedia({video:{facingMode:'user',width:{ideal:1280},height:{ideal:720}},audio:false})
      .then(function(s){
        var vid=$('videoEl'); vid.srcObject=s;
        vid.play().then(function(){
          $('startScreen').style.display='none';
          $('app').style.display='block';
        }).catch(function(e){showErr('Play failed: '+e.message);});
      }).catch(function(e){
        var m='Camera error: '+e.message;
        if(e.name==='NotAllowedError') m='Camera denied. Settings â†’ Safari â†’ Camera â†’ Allow, then reload.';
        else if(e.name==='NotFoundError') m='No camera found.';
        showErr(m);
      });
  });
  function showErr(m){ $('startBtn').disabled=false; $('startBtn').textContent='ğŸ“¸ Try Again'; $('errMsg').textContent=m; $('errMsg').style.display='block'; }

  /* â”€â”€ FILTERS â”€â”€ */
  document.querySelectorAll('.f-btn').forEach(function(btn){
    btn.addEventListener('click',function(){
      document.querySelectorAll('.f-btn').forEach(function(b){b.classList.remove('on');});
      this.classList.add('on'); activeF=this.dataset.f;
      $('videoEl').style.filter=FCSS[activeF]||'none';
    });
  });

  /* â”€â”€ SHOOT â”€â”€ */
  $('shootBtn').addEventListener('click',function(){
    if(shooting||count>=4) return;
    shooting=true; $('shootBtn').disabled=true;
    $('shootBtn').textContent='ğŸ“¸ Get ready...';
    setTimeout(function(){tick(3);},800);
  });

  function tick(n){
    var el=$('countdownEl'); el.style.opacity='1'; el.textContent=n;
    if(n===0){
      el.textContent='ğŸŒ¸';
      setTimeout(function(){el.style.opacity='0'; capturePhoto();},380); return;
    }
    setTimeout(function(){tick(n-1);},900);
  }

  function capturePhoto(){
    var fl=$('flashEl'); fl.style.opacity='1';
    setTimeout(function(){fl.style.opacity='0';},180);

    var vid=$('videoEl'), canvas=$('canvas');
    var vw=vid.videoWidth||640, vh=vid.videoHeight||480;
    canvas.width=vw; canvas.height=vh;
    var ctx=canvas.getContext('2d');
    ctx.save(); ctx.translate(vw,0); ctx.scale(-1,1);
    ctx.drawImage(vid,0,0,vw,vh);
    ctx.restore();

    /* apply filter by drawing onto a second canvas with CSS filter */
    var fc=$('filterCanvas'); fc.width=vw; fc.height=vh;
    var fctx=fc.getContext('2d');
    fctx.filter=FCSS[activeF]||'none';
    fctx.drawImage(canvas,0,0);

    var url=fc.toDataURL('image/jpeg',0.95);
    photos.push({url:url,filter:activeF});

    var img=$('img'+count); img.src=url; img.className='f-none'; /* filter already baked in */
    $('slot'+count).classList.add('filled');
    $('p'+count).classList.add('on');
    count++;

    if(count<4){
      $('shootBtn').textContent='âœ“ '+count+' / 4 â€” next in 2s...';
      setTimeout(function(){tick(3);},2000);
    } else {
      shooting=false;
      $('shootBtn').textContent='âœ“ Strip Complete!';
      $('shootBtn').disabled=true;
      $('stickerPanel').style.display='flex';
      $('framePicker').style.display='flex';
      $('actionRow').style.display='flex';
    }
  }

  /* â”€â”€ STICKERS â”€â”€ */
  document.querySelectorAll('.stk-btn').forEach(function(btn){
    btn.addEventListener('click',function(){
      if(activeS===this.dataset.s){activeS=null;this.classList.remove('on');}
      else{document.querySelectorAll('.stk-btn').forEach(function(b){b.classList.remove('on');});activeS=this.dataset.s;this.classList.add('on');}
      for(var i=0;i<4;i++){
        if(activeS&&i<count) $('slot'+i).classList.add('target');
        else $('slot'+i).classList.remove('target');
      }
    });
  });

  for(var i=0;i<4;i++){
    (function(idx){
      $('slot'+idx).addEventListener('click',function(e){
        if(!activeS||idx>=count) return;
        var r=this.getBoundingClientRect();
        var xp=((e.clientX-r.left)/r.width*100).toFixed(2);
        var yp=((e.clientY-r.top)/r.height*100).toFixed(2);
        var sp=document.createElement('span');
        sp.className='stk-item'; sp.textContent=activeS;
        sp.style.left=xp+'%'; sp.style.top=yp+'%';
        $('stk'+idx).appendChild(sp);
      });
    })(i);
  }

  /* â”€â”€ RETAKE â”€â”€ */
  $('retakeBtn').addEventListener('click',function(){
    count=0; photos=[]; activeS=null;
    for(var i=0;i<4;i++){
      $('slot'+i).classList.remove('filled','target');
      $('img'+i).src=''; $('img'+i).className='';
      $('p'+i).classList.remove('on');
      $('stk'+i).innerHTML='';
    }
    document.querySelectorAll('.stk-btn').forEach(function(b){b.classList.remove('on');});
    $('shootBtn').disabled=false; $('shootBtn').textContent='ğŸ“· Take Photo (0 / 4)';
    $('stickerPanel').style.display='none'; $('framePicker').style.display='none'; $('actionRow').style.display='none';
  });


  /* â”€â”€ FRAMES â”€â”€ */
  var FRAMES = {
    'tet':    {
      paper:'#fff8ee', border:'#c0392b', title:'#c0392b', sub:'#b8860b', date:'#c0392b',
      foot:'ğŸ® ğŸŒ¸ ğŸ®', header:'VSA Â· Táº¾T 2026', subtext:'ğŸŒº ChÃºc Má»«ng NÄƒm Má»›i ğŸŒº',
      desc:'Classic red & gold â€” luck and prosperity'
    },
    'gold':   {
      paper:'#fffbe6', border:'#b8860b', title:'#8B6914', sub:'#b8860b', date:'#8B6914',
      foot:'âœ¨ ğŸ’› âœ¨', header:'VSA Â· Táº¾T 2026', subtext:'ğŸŒŸ ChÃºc Má»«ng NÄƒm Má»›i ğŸŒŸ',
      desc:'Gold â€” wealth and fortune'
    },
    'peach':  {
      paper:'#fff5f8', border:'#e8829a', title:'#c0395a', sub:'#e8829a', date:'#c0395a',
      foot:'ğŸŒ¸ ğŸŒº ğŸŒ¸', header:'VSA Â· Táº¾T 2026', subtext:'ğŸŒ¸ ChÃºc Má»«ng NÄƒm Má»›i ğŸŒ¸',
      desc:'Hoa Ä‘Ã o â€” peach blossom of the North'
    },
    'dragon': {
      paper:'#f0fff4', border:'#1a5c2e', title:'#1a5c2e', sub:'#2ecc71', date:'#1a5c2e',
      foot:'ğŸ ğŸ‡ ğŸ', header:'VSA Â· Táº¾T 2026', subtext:'ğŸ NÄƒm BÃ­nh Ngá» ğŸ',
      desc:'Green dragon â€” strength and power'
    },
    'night':  {
      paper:'#0d0d1a', border:'#f0c040', title:'#f0c040', sub:'#e8829a', date:'#f9c784',
      foot:'ğŸ† âœ¨ ğŸ†', header:'VSA Â· Táº¾T 2026', subtext:'ğŸ† ChÃºc Má»«ng NÄƒm Má»›i ğŸ†',
      desc:'Fireworks night â€” celebration'
    },
    'spring': {
      paper:'#fff9f0', border:'#f77f00', title:'#d35400', sub:'#f77f00', date:'#d35400',
      foot:'ğŸŠ ğŸŒ¼ ğŸŠ', header:'VSA Â· Táº¾T 2026', subtext:'ğŸŠ ChÃºc Má»«ng NÄƒm Má»›i ğŸŠ',
      desc:'Kumquat tree â€” good luck & abundance'
    }
  };
  var activeFrame = 'tet';

  document.querySelectorAll('.frame-opt').forEach(function(opt){
    opt.addEventListener('click', function(){
      document.querySelectorAll('.frame-opt').forEach(function(o){ o.classList.remove('active'); });
      this.classList.add('active');
      activeFrame = this.dataset.frame;
      applyFrameToStrip(activeFrame);
    });
  });

  function applyFrameToStrip(fid){
    var f = FRAMES[fid];
    var card = document.querySelector('.strip-card');
    card.style.background = f.paper;
    card.style.borderTopColor = f.border;
    card.style.borderBottomColor = f.border;
    card.querySelector('.vsa').style.color = f.title;
    card.querySelector('.sub').style.color = f.sub;
    card.querySelector('.sub').textContent = f.subtext;
    document.getElementById('stripDate').style.color = f.date;
    card.querySelector('.flowers').textContent = f.foot;
    card.querySelector('.strip-head').style.borderBottomColor = f.border + '44';
  }

  /* â”€â”€ SAVE â”€â”€ */
  /* Build the strip by compositing stored photo data directly onto canvas.
     Photos already have filter baked in so we just draw them.
     Dimensions mirror the CSS exactly so saved = preview. */
  $('saveBtn').addEventListener('click',function(){
    var btn=this; btn.textContent='â³ Saving...'; btn.disabled=true;

    var SC=3;
    /* match CSS: strip-card width=190, padding=14, slot=162x122, gap=6, borders=6 */
    var TW=190, PH=14, PT=14, PB=20, BRD=6;
    var HEAD=56, FOOT=38, SW=162, SH=122, SG=6;
    var TH=BRD+PT+HEAD+(SH+SG)*4-SG+FOOT+PB+BRD;

    var out=document.createElement('canvas');
    out.width=TW*SC; out.height=TH*SC;
    var oc=out.getContext('2d');
    oc.scale(SC,SC);

    /* use active frame theme */
    var fr=FRAMES[activeFrame];
    /* paper */
    oc.fillStyle=fr.paper; oc.fillRect(0,0,TW,TH);
    /* borders */
    oc.fillStyle=fr.border; oc.fillRect(0,0,TW,BRD); oc.fillRect(0,TH-BRD,TW,BRD);
    /* header */
    var hy=BRD+PT;
    oc.fillStyle=fr.title; oc.font='bold 11px serif'; oc.textAlign='center'; oc.textBaseline='top';
    oc.fillText('VSA Â· Táº¾T 2026',TW/2,hy+4);
    oc.fillStyle=fr.sub; oc.font='8px serif';
    oc.fillText(fr.subtext,TW/2,hy+20);
    oc.strokeStyle=fr.border+'44'; oc.lineWidth=0.5;
    oc.beginPath(); oc.moveTo(PH,hy+36); oc.lineTo(TW-PH,hy+36); oc.stroke();

    /* photos */
    var sy=BRD+PT+HEAD;
    photos.forEach(function(p,i){
      var y=sy+i*(SH+SG);
      oc.fillStyle='#e8d5c0'; oc.fillRect(PH,y,SW,SH);
      var im=new Image(); im.src=p.url;
      /* Replicate object-fit:cover â€” crop center of photo to fill slot */
      var srcW=im.naturalWidth||im.width||640;
      var srcH=im.naturalHeight||im.height||480;
      var slotAR=SW/SH;
      var srcAR=srcW/srcH;
      var cropX,cropY,cropW,cropH;
      if(srcAR>slotAR){
        /* photo wider than slot â€” crop sides */
        cropH=srcH; cropW=srcH*slotAR;
        cropX=(srcW-cropW)/2; cropY=0;
      } else {
        /* photo taller than slot â€” crop top/bottom */
        cropW=srcW; cropH=srcW/slotAR;
        cropX=0; cropY=(srcH-cropH)/2;
      }
      oc.drawImage(im,cropX,cropY,cropW,cropH,PH,y,SW,SH);
      /* stickers */
      $('stk'+i).querySelectorAll('.stk-item').forEach(function(s){
        var lp=parseFloat(s.style.left)/100;
        var tp=parseFloat(s.style.top)/100;
        oc.font='18px serif'; oc.textAlign='center'; oc.textBaseline='middle';
        oc.fillText(s.textContent,PH+lp*SW,y+tp*SH);
      });
    });

    /* footer */
    var fy=sy+4*(SH+SG)-SG;
    oc.font='14px serif'; oc.textAlign='center'; oc.textBaseline='top';
    oc.fillStyle=fr.title; oc.fillText(fr.foot,TW/2,fy+6);
    oc.fillStyle=fr.date; oc.font='7px monospace';
    oc.fillText($('stripDate').textContent,TW/2,fy+24);

    /* show in overlay */
    $('saveImg').src=out.toDataURL('image/png');
    $('saveOverlay').style.display='flex';
    btn.textContent='â†“ Save Strip'; btn.disabled=false;
  });

  $('closeOverlay').addEventListener('click',function(){
    $('saveOverlay').style.display='none';
  });

})();
</script>
</body>
</html>
